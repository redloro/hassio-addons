# Copyright (c) 2019 Ryan Snodgrass <rsnodgrass@gmail.com>
#
# Bi-directional RS232 definitions for Xantech MRC88 interfaces.

# FIXME:
# - validation of arguments (including zone_number, etc)

module_name: xantech-mrc88

get:
    - route: "/zones/<int:zone_number>"
      serial: "?<zone_number>ZD+"
      response: "#{z#}ZS PR{0/1} SS{s#} VO{v#} MU{0/1} TR{bt#} BS{bt#} BA{b#} LS{0/1} PS{0/1}+"
      description: Get current state of the given zone

# GET /xantech/zones/<zone>
# Zone Data
# ?(z#}ZD+
# RESPONSE..... #{z#}ZS PR{0/1} SS{s#} VO{v#} MU{0/1} TR{bt#} BS{bt#} BA{b#} LS{0/1} PS{0/1}+
#   #6ZS PR1 SS4 VO8 MU0 TR7 BS7 BA32 LS0 PS0+
#{
#  zone: 6,
#  power: on/off (0/1),
#  source: <source number>,
#  volume: level,
#  mute: on/off
#}

# GET /xantech/zones
#   returns a set of configured zones (NOT RS232, hand configured)
#   { zones = [ 0, 1, 6, 7] }
#   ... OR PERHAPS...current state of ALL zones!!!

put:
    - route: "/zones/<int:zone_number>/power/on"
      serial: "!<zone_number>?PR1+"
      description: Turn power on for this zone
    - route: "/zones/<int:zone_number>/power/off"
      serial: "!<zone_number>?PR0+"
      description: Turn power off for this zone

    - route: "/zones/<int:zone_number>/volume/up"
      serial: "!<zone_number>VI+"
      description: Turn volume up for zone
    - route: "/zones/<int:zone_number>/volume/down"
      serial: "!<zone_number>VD+
      description: Turn volume down for zone
    - route: "/zones/<int:zone_number>/volume/<int:level>"
      serial: "!<zone_number>?PT+"
      description: Set volume level between 0-100 for zone (FIXME: validation?)

    - route: "/zones/<int:zone_number>/mute/on"
      serial: "!<zone_number>?MT1+"
      description: Mute this zone
    - route: "/zones/<int:zone_number>/mute/off"
      serial: "!<zone_number>?MT0+"
      description: Unmute this zone
#    - route: "/zones/<int:zone_number>/mute/toggle"
#      serial: "!<zone_number>?MT+"
#      description: Toggle mute for this zone

    - route: "/zones/<int:zone_number>/source/<int:source>"
      serial: "!<zone_number>SS<source>+"
      description: "Change the zone's input source (source=1-6)"

## Hardware Interface Notes

#The RS232 connector on the rear of the Xantech MRC88 and related controllers are wired such
#that the Transmit and Receive lines already interchanged for direct communication with
#a PC/RPi/etc using a standard RS232 serial cable (no Null Modem cable required).
#
#The Xantech RS232 connector pin out is:
#
#PIN # FUNCTION
#1, 8, & 9 NC
#2 Tx
#3 Rx
#4 DTR
#5 GND
#6 DSR



## See Also

* Xantech MRC88 RS332 Digital Interface manual

## Feature Requests

* subscribe to periodic and "zone change" status updates

No plans to implement:

* per-zone control of bass/treble/balance/etc


Note that no plans exist to integrate or support Xantech mutli-zone room control pads. This is purely for allowing HA control of \
a Xantech multi-zone audio system.

